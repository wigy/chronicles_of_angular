/* Chronicles of Angular v0.5.4-beta
 * Copyright (c) 2016 Tommi Ronkainen
 */
Object.defineProperty(String.prototype,"ucfirst",{value:function(a){var b=this.toString();return b.length&&(b=b[0].toUpperCase()+b.substr(1)),b}}),Object.defineProperty(String.prototype,"code2human",{value:function(a){var b=this.split("_");return b.map(function(a){return a.ucfirst()}).join(" ")}}),angular.module("coa.audio",[]),angular.module("coa.auth",["coa.data"]),angular.module("coa.core",[]),angular.module("coa.data",["coa.core","coa.store"]),angular.module("coa.datetime",["coa.data"]),angular.module("coa.input",[]),angular.module("coa.store",["coa.core"]),angular.module("coa.store").run(function(){d.channels({STORE:null})}),function(){function a(a){angular.forEach(a,function(a,b){f[b]=new Audio(a)})}function b(a){return"list"===a?Object.keys(f):a in f?void f[a].play():void d.error("Invalid audio name:",a)}function c(){return Object.keys(f)}var e=angular.module("coa.audio"),f={};e.service("player",[function(){return{load:a,list:c,play:b}}])}(),function(){var a,b=angular.module("coa.auth");b.factory("User",["Data","TypeStr",function(b,c){return a?a:(a=function(a){this.init(a)},a.prototype=new b([{name:new c({required:!0})}]),a.prototype.__class="coa.auth.User",a)}])}(),function(){var a,b=angular.module("coa.core");b.factory("Class",[function(){return a?a:(a=function(){},a.prototype={},a.prototype.__class="coa.core.Class",a.prototype.toString=function(){for(var b="",c=Object.getOwnPropertyNames(this).sort(),d=!1,e=0;e<c.length;e++)if("_"!==c[e][0]&&"$"!==c[e][0]){var f=c[e]+": ",g=this[c[e]];if(g&&g.__class)f+=g.toString();else{if("function"==typeof g)continue;if(g instanceof Array){f+="[";for(var h=0;h<g.length;h++)h&&(f+=", "),f+=g[h]instanceof a?g[h].toString():JSON.stringify(g[h]);f+="]"}else f+=JSON.stringify(g)}d&&(b+=", "),b+=f,d=!0}return this.__class?(b&&(b="{"+b+"}"),this.__class.split(".").pop()+"("+b+")"):"{"+b+"}"},a)}])}(),function(){var a,b=angular.module("coa.core");b.factory("Option",["Class",function(b){return a?a:(a=function(a){this.init(a)},a.prototype=new b,a.prototype.__class="coa.core.Option",a.prototype.init=function(a){a=a||{},this.text=void 0===a.text?null:a.text,this.type=void 0===a.type?function(){return!0}:a.type,this["default"]=void 0===a["default"]?null:a["default"],this.required=void 0===a.required?!1:a.required,this.op=void 0===a.op?function(){return null}:a.op},a.prototype.operate=function(a,b){return void 0===a?void d.error("Undefined value given for Option.operate() option",this):(b=Array.prototype.slice.call(arguments),this.op.apply(this,b))},a)}])}(),function(){var a,b=angular.module("coa.core");b.factory("Options",["Class","Option",function(b,c){return a?a:(a=function(a){this.init(a)},a.prototype=new b,a.prototype.__class="coa.core.Options",a.prototype.init=function(a){if(a)for(var b in a)this[b]=new c(a[b])},a.prototype.inherit=function(b){for(var d=Object.keys(this),e=new a,f=0;f<d.length;f++)e[d[f]]=new c(angular.extend({},this[d[f]]));return e.init(b),e},a.prototype.inheritExcept=function(a,b){for(var c=this.inherit(b),d=a.split(","),e=0;e<d.length;e++)delete c[d[e]];return c},a.prototype.validate=function(a){var b;a=a||{};for(b in a){if(!this[b])return null;if(this[b].type instanceof Function){if(!this[b].type(a[b]))return null}else if(typeof a[b]!==this[b].type)return null}for(var c,d=Object.keys(this),e=0;e<d.length;e++)if(b=d[e],void 0===a[b]){if(this[b].required)return null;c||(c={},angular.extend(c,a)),c[b]=this[b]["default"]}return c?c:a},a.prototype.operate=function(a,b){var c={},d=Array.prototype.splice.call(arguments,1);d.splice(0,0,null);for(var e=Object.keys(this),f=0;f<e.length;f++)d[0]=a[e[f]],c[e[f]]=this[e[f]].operate.apply(this[e[f]],d);return c},a.prototype.test=function(a,b){var c=[],d=Array.prototype.splice.call(arguments,1);d.splice(0,0,null);for(var e=Object.keys(this),f=0;f<e.length;f++)d[0]=a[e[f]],this[e[f]].operate.apply(this[e[f]],d)||(null!==this[e[f]].text?c.push(this[e[f]].text.replace(/%o/g,d[0]).replace(/%n/g,e[f]).replace(/%v/g,d[1])):c.push(null));return c},a)}])}(),function(){var a,b=angular.module("coa.data");b.factory("Data",["$q","db","Class","Options","Type",function(b,c,e,f,g){return a?a:(a=function(a,b){this._members=[],this._types={},this._options=this.optionDefinitions.validate(b),this._options||(this.optionDefinitions.validate({}),d.error("Invalid options",b,"for Data",this,"(using defaults instead).")),this._createMembers(a)},a.prototype=new e,a.prototype.__class="coa.data.Data",a.prototype.optionDefinitions=new f({primary_field:{text:"Default field to fill when a single atom value is given to the constructor.",type:"string"}}),a.prototype.toJSON=function(){for(var a={},b=0;b<this._members.length;b++)a[this._members[b]]=this._types[this._members[b]].toJSON(this[this._members[b]]);return a},a.prototype._createMembers=function(a){if(!(a instanceof Array))return void d.error("Invalid arguments",a,"for Data");for(var b=0;b<a.length;b++)for(var c=Object.keys(a[b]),e=0;e<c.length;e++)this._addMember(c[e],a[b][c[e]])},a.prototype._addMember=function(a,b){return"string"!=typeof a?void d.error("Invalid name for a data member",a,"with definition",b):b instanceof g?(null===b.options.label&&(b.options.label=a.code2human()),this._types[a]?void d.error("Trying to define member",a,"as",b,"but it has been already defined as",this._types[a],"in",this):(this._members.push(a),void(this._types[a]=b))):void d.error("Invalid type",b,"given for",this)},a.prototype.reset=function(){this._id=null;for(var a=0;a<this._members.length;a++)this[this._members[a]]=this._types[this._members[a]].copy(this._types[this._members[a]].getDefault())},a.prototype.copy=function(a){if(a.__class!==this.__class)return d.error("Mismatching classes when trying to copy",a,"into",this),void this.reset();for(var b=0;b<this._members.length;b++)this[this._members[b]]=this._types[this._members[b]].copy(a[this._members[b]]);this._id=a._id},a.prototype.init=function(b){var c;if(this.reset(),b instanceof a){if(b.__class!==this.__class)return void d.error("Cannot initialize '"+this.__class+"' object",this," from '"+b.__class+"' object",b);b=b.toJSON()}if(void 0!==b){if(!(b instanceof Object))return this._options.primary_field?(c=this._types[this._options.primary_field])?void c.set(this,this._options.primary_field,b):void d.error("Invalid primary field '"+this._options.primary_field+"' defined for",this):void d.error("Invalid initial values",b,"for",this);for(var e in b)c=this._types[e],c?c.set(this,e,b[e]):"_id"===e?this._id=b._id:d.error("Invalid member name '"+e+"' in initial data",b,"for",this)}},a.prototype.getModuleAndClass=function(){return this.__class},a.prototype.getTypes=function(){return this._types},a.prototype.getType=function(a){var b=this._types[a];return b?b:null},a.prototype.isInvalid=function(){for(var a={},b=!1,c=0;c<this._members.length;c++){var d=this._types[this._members[c]].isInvalid(this[this._members[c]]);d&&(a[this._members[c]]=d,b=!0)}return b?a:!1},a.prototype.isValid=function(){return!this.isInvalid()},a.prototype.getId=function(){return d(this),null===this._id?null:this._id.split(":")[1]},a.prototype.getStorage=function(){return null===this._id?null:this._id.split(":")[0]},a.prototype.save=function(a){if(this.isInvalid()){var e=b.defer();return d.error("Cannot save",this,"since it has errors:",this.isInvalid()),e.reject("Cannot save invalid object."),e.promise}if(a=a||"default",null===this._id){var f=this;return c.insert(a,this).then(function(b){return f._id=a+":"+b,f._id})}return c.update(this.getStorage(),this.__class,{_id:this.getId()},this.toJSON())},a.prototype.load=function(a){var e=a.split(":"),f=e[0],g=e[1],h=this,i=c.find(f,this.__class,{_id:g});return i.then(function(c){if(!c.length){h.reset(),d.error("Cannot load",h.__class,"with id",a);var e=b.defer();return e.reject("Cannot load "+h.__class+" with id "+a),e.promise}return h.init(c[0]),h._id=a,h})},a.prototype.find=function(a,b){return c.find("default",this.__class,a,b)},a.prototype.update=function(a,b,d){return c.update("default",this.__class,a,b,d)},a)}])}(),function(){var a,b=angular.module("coa.data");b.factory("Type",["Class","Options",function(b,c){return a?a:(a=function(a){void 0===a?this.options=this.optionDefinitions.validate({})||{}:this.init(a)},a.prototype=new b,a.prototype.__class="coa.data.Type",a.prototype.optionDefinitions=new c({required:{text:"This value is required.",type:"boolean","default":!1,required:!1,op:function(a,b){return!(a&&null===b)}},"default":{"default":null,op:function(a,b){return!0}},label:{type:"string","default":null,op:function(a,b){return!0}}}),a.prototype.toString=function(){for(var a=Object.keys(this.options),c={},d=0;d<a.length;d++)null!==this.options[a[d]]&&(c[a[d]]=this.options[a[d]]);return this.__class.split(".").pop()+"("+b.prototype.toString.call(c)+")"},a.prototype.toJSON=function(a){return a},a.prototype.init=function(a){this.options={};var b=this.optionDefinitions.validate(a||{});if(!b)return void d.error("Invalid options",a,"for type",this);this.options=b;var c=this.convert(this.options["default"]);void 0===c&&(d.error("Invalid default value",this.options["default"],"for",this),c=null),this.options["default"]=c},a.prototype.convert=function(a){return a},a.prototype.getDefault=function(){return angular.copy(this.options["default"])},a.prototype.isInvalid=function(a){if(void 0===this.convert(a))return["Value has not correct type."];var b=this.optionDefinitions.test(this.options,a);return b.length?b:!1},a.prototype.isValid=function(a){return!this.isInvalid(a)},a.prototype.toJSON=function(a){return a},a.prototype.copy=function(a){return a},a.prototype.set=function(a,b,c){var e=this.convert(c);return void 0===e&&(d.error("Invalid value",c,"for member of type",this,"for object",a),e=this.getDefault()),a[b]=e,e},a)}])}(),function(){var a,b=angular.module("coa.data");b.factory("TypeAny",["Type",function(b){return a?a:(a=function(a){b.call(this,a)},a.prototype=new b,a.prototype.__class="coa.data.TypeAny",a.prototype.convert=function(a){return void 0===a?void 0:a},a)}])}(),function(){var a,b=angular.module("coa.data");b.factory("TypeBool",["Type",function(b){return a?a:(a=function(a){b.call(this,a)},a.prototype=new b,a.prototype.__class="coa.data.TypeBool",a.prototype.convert=function(a){return null===a||a===!1||a===!0?a:void 0},a)}])}(),function(){var a,b=angular.module("coa.data");b.factory("TypeDict",["Type",function(b){return a?a:(a=function(a){b.call(this,a)},a.prototype=new b,a.prototype.__class="coa.data.TypeDict",a.prototype.optionDefinitions=b.prototype.optionDefinitions.inheritExcept("required",{type:{text:"Incorrect value in the collection.",type:function(a){return a instanceof b},required:!0,op:function(a,b){if(null===b)return!0;for(var c=Object.keys(b),d=0;d<c.length;d++)if(!a.isValid(b[c[d]]))return!1;return!0}}}),a.prototype.optionDefinitions["default"]["default"]={},a.prototype.convert=function(a){if(null===a)return a;if(a instanceof Object){for(var b,c,d=Object.keys(a),e={},f=0;f<d.length;f++){if(b=d[f],c=this.options.type.convert(a[b]),void 0===c)return;e[b]=c}return e}},a.prototype.toJSON=function(a){if(null===a)return null;for(var b,c,d=Object.keys(a),e={},f=0;f<d.length;f++)b=d[f],c=this.options.type.toJSON(a[b]),e[b]=c;return e},a)}])}(),function(){var a,b=angular.module("coa.data");b.factory("TypeInt",["Type",function(b){return a?a:(a=function(a){b.call(this,a)},a.prototype=new b,a.prototype.__class="coa.data.TypeInt",a.prototype.convert=function(a){if(null===a)return null;if("number"==typeof a&&a===Math.round(a))return a},a)}])}(),function(){var a,b=angular.module("coa.data");b.factory("TypeList",["Type",function(b){return a?a:(a=function(a){b.call(this,a)},a.prototype=new b,a.prototype.__class="coa.data.TypeList",a.prototype.optionDefinitions=b.prototype.optionDefinitions.inherit({required:{text:"At least one is required.",type:"boolean",op:function(a,b){return a?b instanceof Array?b.length>0:!1:!0}},type:{text:"Incorrect value in the list.",type:function(a){return a instanceof b},required:!0,op:function(a,b){if(null===b)return!0;for(var c=0;c<b.length;c++)if(!a.isValid(b[c]))return!1;return!0}}}),a.prototype.optionDefinitions["default"]["default"]=[],a.prototype.convert=function(a){if(null===a)return a;if(a instanceof Array){for(var b=new Array(a.length),c=0;c<a.length;c++)b[c]=this.options.type.convert(a[c]);return b}},a.prototype.toJSON=function(a){if(null===a)return null;for(var b=[],c=0;c<a.length;c++)b.push(this.options.type.toJSON(a[c]));return b},a)}])}(),function(){var a,b=angular.module("coa.data");b.factory("TypeObj",["Type","Data","factory",function(b,c,d){return a?a:(a=function(a){b.call(this,a)},a.prototype=new b,a.prototype.__class="coa.data.TypeObj",a.prototype.optionDefinitions=b.prototype.optionDefinitions.inherit({"class":{text:"Value must belong to %o class.",type:"string",required:!0,op:function(a,b){return b instanceof c?a===b.getModuleAndClass():null===b}}}),a.prototype.convert=function(a){return void 0!==a?null===a||a instanceof c?a:a instanceof Object?d.create(this.options["class"],a):void 0:void 0},a.prototype.copy=function(a){return null===a?null:d.create(this.options["class"],a.toJSON())},a.prototype.toJSON=function(a){return null===a?null:a.toJSON()},a)}])}(),function(){var a,b=angular.module("coa.data");b.factory("TypeOptions",["Type","TypeDict","Options",function(b,c,d){return a?a:(a=function(a){b.call(this,a)},a.prototype=new c,a.prototype.__class="coa.data.TypeOptions",a.prototype.optionDefinitions=c.prototype.optionDefinitions.inheritExcept("type",{options:{text:"Incorrect or missing option value.",type:function(a){return a instanceof d},required:!0,op:function(a,b){return null===b?!0:a.validate(b)?!0:!1}}}),a.prototype.convert=function(a){return null===a?a:a instanceof Object?(a=this.options.options.validate(a),a?a:void 0):void 0},a.prototype.toJSON=function(a){return null===a?null:angular.extend({},a)},a)}])}(),function(){var a,b=angular.module("coa.data");b.factory("TypePair",["Type","TypeTuple",function(b,c){if(a)return a;a=function(a){b.call(this,a)},a.prototype=new c,a.prototype.__class="coa.data.TypePair",a.prototype.optionDefinitions=c.prototype.optionDefinitions.inherit({});var d=a.prototype.optionDefinitions.types.type;return a.prototype.optionDefinitions.types.type=function(a){return d(a)&&2===a.length},a}])}(),function(){var a,b=angular.module("coa.data");b.factory("TypeStr",["Type",function(b){return a?a:(a=function(a){b.call(this,a)},a.prototype=new b,a.prototype.__class="coa.data.TypeStr",a.prototype.optionDefinitions=b.prototype.optionDefinitions.inherit({pattern:{text:"Value does not have correct format.",type:function(a){return null===a||a instanceof RegExp},required:!1,"default":null,op:function(a,b){return null!==b&&a?a.test(b):!0}}}),a.prototype.convert=function(a){return null===a||"string"==typeof a?a:void 0},a)}])}(),function(){var a,b=angular.module("coa.data");b.factory("TypeTriple",["Type","TypeTuple",function(b,c){if(a)return a;a=function(a){b.call(this,a)},a.prototype=new c,a.prototype.__class="coa.data.TypeTriple",a.prototype.optionDefinitions=c.prototype.optionDefinitions.inherit({});var d=a.prototype.optionDefinitions.types.type;return a.prototype.optionDefinitions.types.type=function(a){return d(a)&&3===a.length},a}])}(),function(){var a,b=angular.module("coa.data");b.factory("TypeTuple",["Type",function(b){return a?a:(a=function(a){b.call(this,a)},a.prototype=new b,a.prototype.__class="coa.data.TypeTuple",a.prototype.optionDefinitions=b.prototype.optionDefinitions.inherit({types:{text:"Invalid tuple members.",type:function(a){if(a instanceof Array){for(var c=0;c<a.length;c++)if(!(a[c]instanceof b))return!1;return!0}return!1},required:!0,op:function(a,b){if(null===b)return!0;if(b instanceof Array){if(a.length!==b.length)return!1;for(var c=0;c<a.length;c++)if(!a[c].isValid(b[c]))return!1;return!0}return!1}}}),a.prototype.convert=function(a){return null===a?null:a instanceof Array?a:void 0},a)}])}(),function(){var a=angular.module("coa.data"),b={};a.service("factory",[function(){function a(a,c){if(1===arguments.length){var e=a.split(".");c=e.pop(),a=e.join(".")}if(b[a]&&b[a][c])return b[a][c];var f;try{f=angular.injector(["ng",a])}catch(g){return d.error("There is no such module than",a),null}return f.has(c)?(b[a]||(b[a]={}),b[a][c]=f.get(c),b[a][c]):(d.error("There is no such class than",c,"defined in the module",a),null)}function c(b,c,d){if(arguments.length<3){var e=b.split(".");d=c,c=e.pop(),b=e.join(".")}var f=a(b,c);return f?new f(d):null}return{constructor:a,create:c}}])}(),function(){var a,b=angular.module("coa.datetime");b.factory("TimeStr",["Class","Data","TypeStr","TypeBool",function(b,c,d,e){return a?a:(a=function(a){this.init(a)},a.prototype=new c([{time:new d({"default":"00:00:00",pattern:/^\d\d:\d\d:\d\d$/})},{negative:new e({"default":!1})},{overflow:new e({"default":!1})}],{primary_field:"time"}),a.prototype.__class="coa.datetime.TimeStr",a.prototype.toString=function(){return this.negative?"-"+this.time:this.time},a.now=function(){var b=new a;return b.setNow(),b},a.prototype["short"]=function(){return this.negative?this.toString().substr(0,6):this.toString().substr(0,5)},a.prototype.add=function(a,b,c){var d=this.time.split(":");c+=parseInt(d[2]),b+=Math.floor(c/60),c%=60,b+=parseInt(d[1]),a+=Math.floor(b/60),b%=60,a+=parseInt(d[0]),a>=24&&(this.overflow=!0),a%=24,this.time=("0"+a).substr(-2,2)+":"+("0"+b).substr(-2,2)+":"+("0"+c).substr(-2,2)},a.prototype.addSeconds=function(b){if(b>0)this.add(0,0,b);else{var c=new a("00:00:00"),d=this.seconds()+b;0>d?(c.addSeconds(-d),this.time=c.time,this.negative=!0):(c.addSeconds(d),this.time=c.time)}},a.prototype.setNow=function(){this.time=(new Date).toJSON().substr(11,8);var a=-(new Date).getTimezoneOffset()/60;a>0&&this.add(a,0,0),0>a&&this.add(24+a,0,0)},a.prototype.notYet=function(a){return this.time.toString()<a.toString()},a.prototype.isPast=function(a){return this.time.toString()>a.toString()},a.prototype.isAlready=function(a){return this.time.toString()>=a.toString()},a.prototype.seconds=function(){var a,b,c,d=this.time.split(":");return a=parseInt(d[0]),b=parseInt(d[1]),c=parseInt(d[2]),60*a*60+60*b+c},a.prototype.diff=function(b){var c=this.seconds(),d=b.seconds(),e=new a;return d>c?(e.add(0,0,d-c),e.negative=!0):e.add(0,0,c-d),e},a)}])}(),function(){var a=angular.module("coa.input");a.directive("keyHandler",[function(){var a={32:"Space"};return{restrict:"A",link:function(b,c,e){c.bind("keypress",function(c){var f="Unknown key "+c.keyCode;c.charCode>=65&&c.charCode<=90?f=String.fromCharCode(c.charCode):c.charCode>=97&&c.charCode<=122?f=String.fromCharCode(c.charCode).toUpperCase():c.charCode>=33&&c.charCode<=47?f=String.fromCharCode(c.charCode):c.charCode>=48&&c.charCode<=57?f=String.fromCharCode(c.charCode):c.charCode in a&&(f=a[c.charCode]);var g=b.$eval(e.keyHandler);g?b.$apply(function(){g(f)}):d.error("Cannot find key-press handler",e.coaKeyHandler)})}}}])}(),function(){var a,b=angular.module("coa.store");b.factory("Engine",["Class",function(b){return a?a:(a=function(a){this.url=null,this.server=null},a.prototype=new b,a.prototype.__class="coa.store.Engine",a.prototype.init=function(a){this.url=a;var b=/^(memory):\/\/([^:\/\s#]+)$/.exec(a);b||d.fatal("Invalid resource URI for database Engine:",a),b[2]&&(this.server=b[2])},a.prototype.insert=function(a,b,c,e){d.warning("No implementation for insert() in",this.__class),a.reject("No implementation for insert().")},a.prototype.find=function(a,b,c,e){d.warning("No implementation for find() in",this.__class),a.reject("No implementation for find().")},a.prototype.update=function(a,b,c,e,f){d.warning("No implementation for update() in",this.__class),a.reject("No implementation for update().")},a.prototype.destroy=function(a){d.warning("No implementation for destroy() in",this.__class),a.reject("No implementation for destroy().")},a)}])}(),function(){var a,b=angular.module("coa.store"),c={};b.factory("EngineMemory",["Engine",function(b){return a?a:(a=function(a){this.init(a),this.server in c||(c[this.server]={})},a.prototype=new b,a.prototype.__class="coa.store.EngineMemory",b.prototype.insert=function(a,b,d,e){b in c[this.server]||(c[this.server][b]={});var f=(Object.keys(c[this.server][b]).length+1).toString();c[this.server][b][f]=angular.copy(d),c[this.server][b][f]._id=f,a.resolve(f)},a.prototype.find=function(a,b,d,e){var f=[];if(b in c[this.server]){for(var g in c[this.server][b])f.push(angular.copy(c[this.server][b][g]));f=d.search(f)}a.resolve(f)},b.prototype.update=function(a,b,d,e,f){if(b in c[this.server]){var g=d.search(c[this.server][b]);for(var h in g)angular.extend(g[h],angular.copy(e))}a.resolve({})},a.prototype.destroy=function(a){c[this.server]={},a.resolve(!0)},a)}])}(),function(){var a,b=angular.module("coa.store");b.factory("Lookup",["Class",function(b){return a?a:(a=function(a){"string"==typeof a?a={_id:a}:arguments.length?("object"!=typeof a||null===a)&&(d.error("Invalid lookup",a),a={}):a={},this.lookup=a},a.prototype=new b,a.prototype.__class="coa.store.Lookup",a.prototype.search=function(a){var b=[];for(var c in a){var d=!0;for(var e in this.lookup)if(a[c][e]!==this.lookup[e]){d=!1;break}d&&b.push(a[c])}return b},a)}])}(),function(){var a=angular.module("coa.store");a.service("db",["$q","$rootScope","dbconfig","Options","Lookup",function(a,b,c,e,f){function g(a){var b,c=/^(\w+):/.exec(a);c||d.fatal("Invalid engine URI",a);try{var e=angular.injector(["ng","coa.store"]).get("Engine"+c[1].ucfirst());b=new e(a)}catch(f){d.fatal("Unable to instantiate engine for URI",a,f)}return d("STORE","Creating an engine for URI",a,":",b),b}function h(a){c.has(a)||d.fatal("Trying to access data storage that is not configured:",a);var b=c.get(a);return b.engine||(b.engine=g(b.url)),b.engine}function i(b,c,f){var g=a.defer(),i=new e({});if(!("toJSON"in c))return d.error("Cannot store objects that does not have toJSON():",c),g.reject("Cannot store objects that does not have toJSON()."),g.promise;if(!c.__class)return d.error("Cannot store objects that does not define __class:",c),g.reject("Cannot store objects that does not define __class."),g.promise;var j=i.validate(f);j||(d.warning("Invalid options",f,"for storage insert(). Using defaults."),j=i.validate({}));var k=h(b),l=c.toJSON(),m=c.__class;return d("STORE","Insert",l,"to collection",m,"in store",b),k.insert(g,m,l,f),g.promise}function j(b,c,g,i){var j=a.defer(),k=new e({}),l=k.validate(i);l||(d.warning("Invalid options",i,"for storage find(). Using defaults."),l=k.validate({}));var m;if("function"==typeof c)m=c.prototype.__class;else{if("string"!=typeof c)return d.error("Invalid class for finding objects",c),j.reject("Invalid class for finding objects."),j.promise;m=c}if(!m)return d.error("Target object constructor for storing does not define class:",c),j.reject("Target object constructor for storing does not define class."),j.promise;g=new f(g||{});var n=h(b);return n.find(j,m,g,i),j.promise.then(function(a){var c=[];if(l.raw)c=a;else for(var e=0;e<a.length;e++)c.push(a[e]);return d("STORE","Find",g,"from collection",m,"in store",b,":",c),c})}function k(b,c,g,i,j){var k=a.defer(),l=new e({}),m=l.validate(j);m||(d.warning("Invalid options",j,"for storage update(). Using defaults."),m=l.validate({}));var n;if("function"==typeof c)n=c.prototype.__class;else{if("string"!=typeof c)return d.error("Invalid class for finding objects",c),k.reject("Invalid class for finding objects."),k.promise;n=c}if(!n)return d.error("Target object constructor for storing does not define class:",c),k.reject("Target object constructor for storing does not define class."),k.promise;if("_id"in i)return d.error("Cannot change _id of",n,"with update",i),k.reject("Cannot change _id with update()."),k.promise;g=new f(g||{});var o=h(b);return o.update(k,n,g,i,j),k.promise}function l(){b.$apply()}function m(b){return h(b).destroy(a.defer())}return{find:j,insert:i,update:k,flush:l,destroy:m}}])}(),function(){function a(){this.dbs={"default":{url:"memory://default",engine:null}}}var b=angular.module("coa.store");a.prototype={},a.prototype.set=function(a,b){a.match(/^[_a-zA-Z0-9]+$/)||d.fatal("Trying to configure invalid storage name",a,"Must use only characters and numbers."),this.dbs[a]={},this.dbs[a].url=b,this.dbs[a].engine=null},a.prototype.has=function(a){return a in this.dbs},a.prototype.get=function(a){return this.dbs[a]?this.dbs[a]:void d.fatal("No such database defined as",a)},b.value("dbconfig",new a)}(),function(){angular.module("templates",[]).run(["$templateCache",function(a){a.put("sample/template.html",'<div style="border: 1px solid gray; width: 200px">\n<h2>Test template</h2>\nSuccessfully embedded.\n</div>')}])}();